#include "MIDIConv.h"

float calcMIDIhz(int8_t n) {
    return 440 * pow(2, (n - 69) / 12);
}

float calcMIDIus(int8_t n) {
    return 1000000.0 / calcMIDIhz(n);
}

static const uint16_t midi_us[] PROGMEM = {
    64793,
    61156,
    57724,
    54484,
    51426,
    48540,
    45815,
    43244,
    40817,
    38526,
    36364,
    34323,
    32396,
    30578,
    28862,
    27242,
    25713,
    24270,
    22908,
    21622,
    20408,
    19263,
    18182,
    17161,
    16198,
    15289,
    14431,
    13621,
    12856,
    12135,
    11454,
    10811,
    10204,
    9631,
    9091,
    8581,
    8099,
    7645,
    7215,
    6810,
    6428,
    6067,
    5727,
    5405,
    5102,
    4816,
    4545,
    4290,
    4050,
    3822,
    3608,
    3405,
    3214,
    3034,
    2863,
    2703,
    2551,
    2408,
    2273,
    2145,
    2025,
    1911,
    1804,
    1703,
    1607,
    1517,
    1432,
    1351,
    1276,
    1204,
    1136,
    1073,
    1012,
    956,
    902,
    851,
    804,
    758,
    716,
    676,
    638,
    602,
    568,
    536,
    506,
    478,
    451,
    426,
    402,
    379,
    358,
    338,
    319,
    301,
    284,
    268,
    253,
    239,
    225,
    213,
    201,
    190,
    179,
    169,
    159,
    150,
    142,
    134,
    127,
    119,
    113,
    106,
    100,
    95,
    89,
    84,
    80,
};

static const uint16_t midi_hz[] PROGMEM = {
    15,
    16,
    17,
    18,
    19,
    21,
    22,
    23,
    24,
    26,
    28,
    29,
    31,
    33,
    35,
    37,
    39,
    41,
    44,
    46,
    49,
    52,
    55,
    58,
    62,
    65,
    69,
    73,
    78,
    82,
    87,
    92,
    98,
    104,
    110,
    117,
    123,
    131,
    139,
    147,
    156,
    165,
    175,
    185,
    196,
    208,
    220,
    233,
    247,
    262,
    277,
    294,
    311,
    330,
    349,
    370,
    392,
    415,
    440,
    466,
    494,
    523,
    554,
    587,
    622,
    659,
    698,
    740,
    784,
    831,
    880,
    932,
    988,
    1047,
    1109,
    1175,
    1245,
    1319,
    1397,
    1480,
    1568,
    1661,
    1760,
    1865,
    1976,
    2093,
    2217,
    2349,
    2489,
    2637,
    2794,
    2960,
    3136,
    3322,
    3520,
    3729,
    3951,
    4186,
    4435,
    4699,
    4978,
    5274,
    5588,
    5920,
    6272,
    6645,
    7040,
    7459,
    7902,
    8372,
    8870,
    9397,
    9956,
    10548,
    11175,
    11840,
    12544,
};

uint16_t getMIDIhz(int8_t n) {
    return (n < 11) ? 15 : pgm_read_word(&midi_hz[n - 11]);
}

uint16_t getMIDIus(int8_t n) {
    return (n < 11) ? 65535 : pgm_read_word(&midi_us[n - 11]);
}